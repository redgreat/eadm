%%%-------------------------------------------------------------------
%%% @author wangcw
%%% @copyright (C) 2024, REDGREAT
%%% @doc
%%%
%%% eadm Controller
%%%
%%% @end
%%% Created : 2024-01-25 09:29:17
%%%-------------------------------------------------------------------
-module(eadm_sys_tv_controller).
-author("wangcw").

%%%===================================================================
%%% 函数导出
%%%===================================================================
-export([index/1]).

%%====================================================================
%% API 函数
%%====================================================================

%%--------------------------------------------------------------------
%% @private
%% @doc
%% index
%%
%% @end
%%--------------------------------------------------------------------
index(_Req) ->
    Tables = [ maps:from_list(X) || X <- observer_backend:get_table_list(ets, [{sys_hidden, true}, {unread_hidden, true}]) ],
    Tables0 = lists:map(fun(A = #{id := Id, owner := Owner}) ->
        Id0 = maybe_convert_id(Id),
        A#{owner => erlang:pid_to_list(Owner), id => Id0}
                        end, Tables),
    {ok, [{tables, Tables0}]}.

%%====================================================================
%% 内部函数
%%====================================================================

%%--------------------------------------------------------------------
%% @private
%% @doc
%% maybe_convert_id
%%
%% @end
%%--------------------------------------------------------------------
maybe_convert_id(ignore) ->
    "";
maybe_convert_id(Ref) ->
    erlang:ref_to_list(Ref).
